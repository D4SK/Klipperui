#:kivy 1.8.0

#:import p parameters

<TimelineTab@TabbedPanelItem>:
    background_down: ''
    background_color: p.background
    canvas:
        Rectangle:
            source: p.kgui_dir+'/logos/timeline.png'
            size: 60,60
            pos: 225-30, 20
    FloatLayout:
        pos: 0, p.tab_height
        canvas.before:
            Color:
                rgba: p.background
            Rectangle:
                size: p.screen_width, p.screen_height - p.tab_height - p.status_bar_height
                pos: 0, p.tab_height
        TitleBar:
            id: title_bar
            enabled: False
            pos_hint: {'x':0, 'top':1}
            title: "Printjob Timeline"
        Timeline:
            id: tl
            viewclass: 'TimelineItem'
            size_hint: None, None
            size: p.screen_width, p.screen_height - title_bar.height - p.tab_height - p.status_bar_height
            pos: 0, p.tab_height
        Btn_QX:
            id: q_x
            right: p.screen_width - p.h_padding +10
            y: p.tab_height + p.padding 
            on_release: tl.remove()
            enabled: tl.selected is not None and tl.selected.status == "queued"
        Btn_QUp:
            id: q_up
            right: q_x.x - p.h_padding  +10
            y: p.tab_height + p.padding
            on_release: tl.move_up()
            enabled: tl.selected is not None and tl.selected.status == "queued"
        Btn_QDown:
            right: q_up.x - p.h_padding  + 10
            y: p.tab_height + p.padding
            on_release: tl.move_down()
            enabled: tl.selected is not None and tl.selected.status == "queued"

<Timeline>:
    TimelineBox:
        id: tl_box
        default_size: None, None
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'
        multiselect: False
        touch_multiselect: False

<TimelineItem>:
    size: p.screen_width, 777
    # Extra background color
    canvas.before:
        Color:
            rgba: p.accent if self.status in {"printing", "paused"} else (0, 0, 0, 0)
        Rectangle:
            size: self.size
            pos: self.pos
    canvas:
        Color:
            rgba: p.translucent_white if (self.selected or self.pressed) else (0,0,0,0)
        Rectangle:
            size: self.size
            pos: self.pos
    #Label
    size_hint_y: None
    height: 40 if self.status == "header" else 110
    text: root.details
    halign: 'center' if self.status == "header" else 'right'
    valign: 'middle'
    max_lines: 1
    padding_x: p.h_padding
    text_size: self.size
    font_size: p.small_font if self.status == "header" else p.normal_font
    color: p.medium_dark_gray if self.status in {"printing", "paused"} else p.medium_light_gray
    italic: self.status == "header"
    Label:
        text: root.name
        shorten: True
        shorten_from: 'right'
        halign: 'left'
        valign: 'middle'
        padding_x: p.h_padding
        size_hint: None, None
        size: root.width - 120, root.height
        pos: root.pos
        text_size: self.size
        font_size: p.normal_font
        color: p.green if root.status == "done" else p.red if root.status == "stopped" else (1,1,1,1)
        bold: root.status == "header"
    Divider:
        y: root.top - 1


# BUTTONS

#:set pad 24
<Btn_QUp@FloatingButton>:
    id: q_up
    btn_color: p.accent
    canvas:
        Color:
            rgba: (1, 1, 1, 1) if self.enabled else (0,0,0,0)
        Triangle:
            points: self.x+pad-4, self.y+pad+4,  self.right-pad+4, self.y+pad+4,  self.center_x, self.top-pad

<Btn_QDown@FloatingButton>:
    btn_color: p.accent
    canvas:
        Color:
            rgba: (1, 1, 1, 1) if self.enabled else (0,0,0,0)
        Triangle:
            points: self.x+pad-4, self.top-pad-4,  self.right-pad+4, self.top-pad-4,  self.center_x, self.y+pad

<Btn_QX@FloatingButton>:
    btn_color: p.accent
    canvas:
        Color:
            rgba: (1,1,1,1) if self.enabled else (0,0,0,0)
        Line:
            points: self.x+pad, self.top-pad,  self.right-pad, self.y+pad
            width: 5
            cap: 'none'
        Line:
            points: self.x+pad, self.y+pad,  self.right-pad, self.top-pad
            width: 5
            cap: 'none'
